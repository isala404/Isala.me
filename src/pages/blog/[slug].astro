---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}
---

<BaseLayout
  title={`${post.data.title} | Isala Piyarisi`}
  description={post.data.description}
  type="article"
  publishedTime={post.data.publishedAt.toISOString()}
>
  <main class="max-w-content relative z-10 mx-auto px-6 py-16 md:py-24">
    <!-- Header -->
    <header class="mb-10">
      <a href="/blog" class="text-summer-text-secondary arrow-link mb-6 inline-block text-sm">
        <span class="arrow">←</span><span class="text">all writing</span>
      </a>

      <h1
        class="text-summer-text mb-4 text-2xl leading-tight font-semibold tracking-tight md:text-3xl"
      >
        {post.data.title}
      </h1>

      <div class="text-summer-text-secondary flex flex-wrap items-center gap-4 text-sm">
        <time datetime={post.data.publishedAt.toISOString()}>
          {formatDate(post.data.publishedAt)}
        </time>
        <span>·</span>
        <span>{post.data.readingTime || 5} min read</span>
        {
          post.data.tags && post.data.tags.length > 0 && (
            <>
              <span>·</span>
              <div class="flex gap-2">
                {post.data.tags.map((tag) => (
                  <a
                    href={`/blog/tag/${tag}`}
                    class="bg-summer-text/5 border-summer-text/10 hover:bg-summer-accent/10 hover:text-summer-accent hover:border-summer-accent/30 rounded border px-2 py-0.5 text-xs transition-colors"
                  >
                    {tag}
                  </a>
                ))}
              </div>
            </>
          )
        }
      </div>
    </header>

    <!-- Content -->
    <article class="prose prose-summer max-w-none">
      <Content />
    </article>
  </main>
</BaseLayout>

<style>
  /* Blog prose styling */
  .prose-summer {
    color: #2a2a35;
  }

  .prose-summer h2 {
    font-size: 1.25rem;
    font-weight: 500;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: #2a2a35;
  }

  .prose-summer h3 {
    font-size: 1.125rem;
    font-weight: 500;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: #2a2a35;
  }

  .prose-summer p {
    font-size: 1rem;
    line-height: 1.75;
    margin-bottom: 1rem;
  }

  .prose-summer a {
    color: #e85a3c;
    text-decoration: underline;
    text-decoration-color: rgba(232, 90, 60, 0.3);
    text-underline-offset: 2px;
    transition: text-decoration-color 0.2s;
  }

  .prose-summer a:hover {
    text-decoration-color: #e85a3c;
  }

  .prose-summer code:not(pre code) {
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    background: rgba(42, 42, 53, 0.05);
    font-size: 0.875rem;
    font-family: 'JetBrains Mono', monospace;
    color: #e85a3c;
  }

  .prose-summer pre {
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    font-size: 0.875rem;
    background: #2a2a35 !important;
    color: #e8e0d5;
  }

  .prose-summer pre code {
    background: none;
    padding: 0;
    color: inherit;
  }

  .prose-summer blockquote {
    border-left: 2px solid rgba(232, 90, 60, 0.4);
    padding-left: 1rem;
    font-style: italic;
    color: #6b6b7a;
  }

  .prose-summer ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    margin: 1rem 0;
  }

  .prose-summer ul li {
    margin: 0.5rem 0;
  }

  .prose-summer ul li::marker {
    color: #e85a3c;
  }

  .prose-summer ol {
    list-style-type: decimal;
    padding-left: 1.5rem;
    margin: 1rem 0;
  }

  .prose-summer ol li {
    margin: 0.5rem 0;
  }

  .prose-summer img {
    border-radius: 0.5rem;
  }

  .prose-summer strong {
    font-weight: 600;
    color: #2a2a35;
  }

  .prose-summer hr {
    border-color: rgba(42, 42, 53, 0.1);
    margin: 2rem 0;
  }
</style>
