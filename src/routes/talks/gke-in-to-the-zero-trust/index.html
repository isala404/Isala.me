<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Securing GKE Workloads: Zero Trust with eBPF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/black.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .container {
            display: flex;
            justify-content: space-between;
        }

        .split-screen {
            display: flex;
            justify-content: space-around;
        }

        .left,
        .right {
            flex: 1;
            padding: 20px;
        }

        .highlight {
            color: #00aaff;
        }

        .warning {
            color: #ff5555;
        }

        .success {
            color: #55ff55;
        }

        code {
            background: #333;
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <!-- Title Slide -->
            <section data-background="#000033">
                <h1>Securing GKE Workloads</h1>
                <h2>Journey to Zero Trust with eBPF</h2>
                <div style="margin-top: 400px; text-align: center;">
                    <p>Isala Piyarisi</p>
                    <p>Senior Software Engineer, WSO2</p>
                    <p>GCP ACE, CKA, CKS</p>
                </div>
                <aside class="notes">
                    Hello everyone! Welcome to this session on securing GKE workloads using eBPF to achieve zero trust
                    architecture.
                    Who here are familiar with kubernetes (atleast heard of it)?
                    I'm Isala Piyarisi, and I work as a Senior Software Engineer at WSO2.
                    I currntly hold both certified kubenates admistrator and certified kubenates security specialist.
                    I was supposed to speak at kubecon NA next week but US embassy denied my visa.
                    So Today, we're going to explore some exciting concepts about modern cloud security, and I'll show you some live demonstrations of how we can implement these in real-world scenarios.
                </aside>
            </section>

            <!-- Zero Trust Introduction -->
            <section>
                <h2>Zero Trust: The New Normal</h2>
                <div class="split-screen">
                    <div class="left">
                        <h3>Traditional Security</h3>
                        <ul>
                            <li>Perimeter-based security</li>
                            <li>Trust by default</li>
                            <li>Network location = Identity</li>
                        </ul>
                    </div>
                    <div class="right">
                        <h3>Zero Trust</h3>
                        <ul>
                            <li>Never trust, always verify</li>
                            <li>Identity-based security</li>
                            <li>Continuous verification</li>
                        </ul>
                    </div>
                </div>
                <div class="flex justify-center">
                    <a href="https://www.statista.com/chart/28878/expected-cost-of-cybercrime-until-2027/"
                        title="Infographic: Cybercrime Expected To Skyrocket in Coming Years | Statista">
                        <img style="height: 600px; width: auto;" src="https://cdn.statcdn.com/Infographic/images/normal/28878.jpeg"
                            alt="Infographic: Cybercrime Expected To Skyrocket in Coming Years | Statista" />
                    </a>
                    <a href="https://www.stationx.net/cyber-security-job-statistics/">
                        <img style="height: 600px; width: auto;"
                        src="https://www.stationx.net/wp-content/uploads/2023/12/3.-Cyber-Security-Staffing-as-a-part-of-Employers-Wider-Cyber-Security-Spending.png"
                        alt="Cyber Security Staffing as a part of Employers Wider Cyber Security Spending" />
                    </a>
                </div>
                <aside class="notes">
                    Let's start by understanding what Zero Trust really means. Traditionally, security was like a
                    castle
                    with a moat -
                    once you're inside, you're trusted. But in today's cloud-native world, this approach doesn't
                    work
                    anymore.
                    Zero Trust follows a simple principle: 'never trust, always verify.' Every request, every
                    connection, and every
                    user must be verified, regardless of where they're coming from.
                </aside>
            </section>

            <!-- Threat Landscape -->
            <section>
                <h2>Modern Threat Landscape in K8s Clusters</h2>
                <div class="content">
                    <ul>
                        <li class="fragment">API Server Exposure</li>
                        <li class="fragment">Container Runtime Vulnerabilities</li>
                        <li class="fragment">Network Security Gaps</li>
                        <li class="fragment">Identity Management Challenges</li>
                        <li class="fragment">Unsecured Kubernetes Dashboard</li>
                        <li class="fragment">RBAC Misconfigurations (Excessive Permissions)</li>
                        <li class="fragment">Insecure Pod Security Policies (PSPs)</li>
                        <li class="fragment">Container Image Vulnerabilities (e.g., outdated or unpatched images)</li>
                        <li class="fragment">Inadequate Namespace Isolation</li>
                        <li class="fragment">Secrets Leakage through Environment Variables</li>
                        <li class="fragment">Node-Level Access Exposures (e.g., unrestricted SSH access)</li>
                        <li class="fragment">...and more</li>
                    </ul>
                </div>
                <aside class="notes">
                    In a GKE environment, the threat landscape is complex and ever-evolving. Let's break down the main
                    areas where
                    attacks commonly occur. First, we have the API server - it's like the control tower of your
                    Kubernetes cluster.
                    If it's not properly secured, attackers can gain administrative access to your entire cluster. Then
                    we have
                    container runtime vulnerabilities - these are like hidden backdoors in your applications. Network
                    security gaps
                    allow lateral movement, similar to an intruder moving freely between rooms once they're inside.
                    Finally, identity
                    management challenges - imagine having thousands of keys but not knowing who has copies of them.
                </aside>
            </section>

            <!-- Attack Vector 1 -->
            <section>
                <h2>Case Study: Tesla</h2>
                <h3>A Exposed Kubernetes Dashboard</h3>
                <div class="content">
                    <div class="flex justify-center">
                        <img src="https://static.isala.me/portfolio/talks/gdg/tesla-k8s-dashboard.png" alt="Tesla's Exposed Kubernetes Dashboard">
                    </div>
                </div>
                <aside class="notes">
                    // Write about how tesla's exposed kubernetes dashboard was used to access the internal network
                    // hackers deploy crypo miner on the nodes
                    // could have been lot worse if user data was persented in the cluster
                </aside>
            </section>

            <!-- Attack Vector 2 -->
            <section>
                <h2>Case Study: Hugging Face</h2>
                <h3>Poor Network Segmentation</h3>
                <div class="content">
                    <div class="flex justify-center">
                        <img src="https://www.datocms-assets.com/75231/1712240351-diagram-3.png" alt="Hugging Face's Poor Network Segmentation">
                    </div>
                </div>
                <aside class="notes">
                    // https://www.wiz.io/blog/wiz-and-hugging-face-address-risks-to-ai-infrastructure
                    // The article discusses the collaboration between Wiz Research and Hugging Face to address security risks associated with AI-as-a-Service platforms. As AI technology rapidly evolves and is adopted by organizations, it poses significant risks, particularly in shared infrastructures that handle sensitive data.

                    Key findings from the research include:
                    
                    - **Security Vulnerabilities**: Wiz Research identified critical risks within Hugging Face's environment, particularly concerning the use of malicious AI models. They demonstrated how attackers could exploit shared inference infrastructure and CI/CD pipelines to gain unauthorized access to other customers' models and applications.
                    
                    - **Malicious Model Risks**: The research highlighted that using untrusted AI models, especially those serialized with Python's Pickle format, can lead to remote code execution vulnerabilities. Attackers could upload malicious models that execute arbitrary code upon deserialization, potentially compromising the entire service.
                    
                    - **Isolation Challenges**: The study emphasized the importance of tenant isolation in cloud environments. The shared nature of AI-as-a-Service raises concerns about whether models run in sufficiently isolated environments to prevent cross-tenant attacks.
                    
                    - **Mitigation Strategies**: To combat these vulnerabilities, the article recommends implementing strong security measures such as sandboxing untrusted models, enhancing authentication for internal container registries, and ensuring robust monitoring and governance of AI infrastructures.
                    
                    In conclusion, while the rapid growth of AI presents exciting opportunities, it also necessitates rigorous security practices to protect against emerging threats in AI service platforms.
                </aside>
            </section>


            <section>
                <h2>Case Study: CVE-2022-0811</h2>
                <h3>Insufficient Pod Security</h3>
                <div class="content">
                    <div class="flex flex-col justify-center gap-4">
                        <img src="https://storage.googleapis.com/static.isala.me/portfolio/talks/gdg/CVE-2022-0811-1.png" alt="CVE-2022-0811 Description">
                        <img src="https://storage.googleapis.com/static.isala.me/portfolio/talks/gdg/CVE-2022-0811-2.png" alt="CVE-2022-0811 Resolution">
                    </div>
                </div>
                <aside class="notes">
                    // https://www.cvedetails.com/cve/CVE-2022-0811/
                    // Explain in service like Continer as a Service (CaaS) platforms let you deploy containers
                    // Explain how this attack was possible due to insufficient pod security will allow attackers to access the host machine using this vulnerability
                </aside>
            </section>

            <!-- eBPF Introduction -->
            <section>
                <h2>Enter eBPF: The Game Changer</h2>
                <div class="content">
                    <ul>
                        <li class="fragment">Extended Berkeley Packet Filter</li>
                        <li class="fragment">Kernel-level Programming</li>
                        <li class="fragment">Safe and Efficient Observability</li>
                    </ul>
                    <div class="fragment flex justify-center">
                        <img style="height: 700px; width: auto;" src="https://raw.githubusercontent.com/iovisor/bcc/refs/heads/master/images/bcc_tracing_tools_2019.png" alt="eBPF Architecture">
                    </div>
                </div>
                <aside class="notes">
                    Now, let's talk about the solution. eBPF is like having a programmable security camera system inside
                    your Linux
                    kernel. It allows us to run sandboxed programs in the kernel space, giving us unprecedented
                    visibility and
                    control over system calls, network traffic, and more. Think of it as having X-ray vision into your
                    entire
                    system, but with the ability to also act on what you see.
                </aside>
            </section>

            <!-- Cilium Overview -->
            <section>
                <h2>Cilium: eBPF-Powered Security</h2>
                <div class="content">
                    <ul>
                        <li class="fragment success">Layer 3-7 Network Security</li>
                        <li class="fragment success">Identity-based Policies</li>
                        <li class="fragment success">Transparent Encryption</li>
                    </ul>
                    <div class="flex justify-center">
                        <img src="https://cilium.io/static/6c69375bdc369895441cdc52ae9801dc/e9407/cilium_arch.png" alt="Cilium Architecture">
                    </div>
                </div>
                <aside class="notes">
                    Cilium leverages eBPF to provide powerful networking, security, and observability. It's like having
                    a smart
                    security system that understands not just IP addresses, but the identity and behavior of your
                    applications.
                    It can enforce security policies at multiple layers, encrypt traffic automatically, and provide
                    detailed
                    visibility into your cluster's communication patterns.
                </aside>
            </section>

            <section>
                <h2>Live Demo</h2>
                <h3>Setup</h3>
                <div style="margin-bottom: 100px; margin-top: 100px;" class="flex flex-col justify-start">
                    <p class="text-left">Demo Steps:</p>
                    <ol>
                        <li class="fragment">Create a GKE node pool with full access scope</li>
                        <li class="fragment">Deploy a pod with Google Cloud CLI</li>
                        <li class="fragment">Deploy a Sample Workload</li>
                        <li class="fragment">Get the admin credentials for the GKE cluster via GCP Metadata Server</li>
                        <li class="fragment">Use the admin credentials to access the Kubernetes API Server</li>
                        <li class="fragment">SSH into node and see though traffic</li>
                    </ol>
                </div>
                <aside class="notes">
                    <code>
                        kubectl run gcloud-cli-pod --image=gcr.io/google.com/cloudsdktool/google-cloud-cli:latest --command -- sleep infinity
                        kubectl label pod gcloud-cli-pod type=user-app
                        kubectl exec -it gcloud-cli-pod -- bash
                        gcloud container clusters get-credentials gdg-demo --zone us-central1-c --project tallisa
                        kubectl debug node/mynode -it --image=ubuntu
                        kubectl apply -f ccnp.yaml -f cnp.yaml
                    </code>
                </aside>
            </section>

            <!-- Live Demo 1 -->
            <section data-background="#1a1a1a">
                <h2>Mitigation: Cilium Network Policies</h2>
                <ol style="margin-bottom: 100px; margin-top: 100px;">
                    <li>Decline Kube API Server by Default</li>
                    <li>Decline GCP Metadata Server by Default</li>
                    <li>Enable mTLS for all traffic</li>
                </ol>
                <aside class="notes">
                    // explain how cilium ccnp and cnp works
                    // explain how it is different from kubenates network policy
                    // explain how it can help mitigate the attack vectors we discussed earlier
                </aside>
            </section>

            <!-- Tetragon -->
            <section>
                <h2>Tetragon: Runtime Security</h2>
                <div class="content">
                    <ul>
                        <li class="fragment">Real-time Security Monitoring</li>
                        <li class="fragment">Process-level Visibility</li>
                        <li class="fragment">Security Policy Enforcement</li>
                    </ul>
                    <div class="flex justify-center">
                        <img style="height: 700px; width: auto;" src="https://tetragon.io/svgs/diagram-illustration.svg" alt="Tetragon Architecture">
                    </div>
                </div>
                <aside class="notes">
                    Tetragon is like having a security camera that can see every process, file access, and network
                    connection in
                    your cluster. It uses eBPF to provide deep visibility into runtime security events. This means we
                    can detect
                    and prevent suspicious activities before they become security incidents.
                </aside>
            </section>

            <!-- Live Demo 2 -->
            <section data-background="#1a1a1a">
                <h2>LIVE DEMO: Simulate Zero-day Attacks</h2>
                <div class="demo-notes">
                    <p>Demo Steps:</p>
                    <ol>
                        <li>Deploy a Privileged Container (To Simulate)</li>
                        <li>Access via chroot (Simulate jailbreaking)</li>
                        <li>Access container runtime</li>
                        <li>Steal Credentials from a Privileged Container</li>
                    </ol>
                </div>
                <aside class="notes">
                    kubectl exec -ti -n kube-system ds/tetragon -c tetragon -- tetra getevents -o compact --pods privileged-pod
                </aside>
            </section>

            <!-- Zero Trust Implementation -->
            <section>
                <h2>Mitigation: Zero Trust in Action</h2>
                <div class="content">
                    <ul>
                        <li>All network traffic is encrypted</li>
                        <li>only allow inidiuvally verifeied connection are allowed</li>
                        <li>Audit All System Calls</li>
                        <li>Allow Only Necessary System Calls</li>
                    </ul>
                </div>
                <aside class="notes">
                    // TODO: rewrite this
                    Let's put it all together. With Cilium, we can implement true zero trust by combining identity-based
                    policies,
                    automatic encryption, and API-aware security. Every connection is authenticated, encrypted, and
                    authorized.
                    No more implicit trust, no more network-level assumptions.
                </aside>
            </section>

            <!-- Cell-Based Architecture -->
            <section>
                <h2>Zero Trust in Production: Cell-Based Architecture</h2>
                <div class="content">
                    <ul>
                        <li class="fragment">Microservices Organization Pattern</li>
                        <li class="fragment">Isolated Security Domains</li>
                        <li class="fragment">Granular Access Control</li>
                    </ul>
                    <div class="flex justify-center">
                        <img style="height: 700px; width: auto;" src="https://wso2.cachefly.net/wso2/sites/all/2023/images/choreo%20project%20trust%20boundaries.png" alt="Cell Architecture">
                    </div>
                </div>
                <aside class="notes">
                    Let me share an interesting architectural pattern we as WSO2 uses in production. The cell-based
                    architecture
                    organizes microservices into autonomous units, each with its own security boundary. This approach,
                    which we've
                    have implemented in choreo, provides natural isolation and makes zero trust easier to
                    implement.
                    It's a practical example of all the concepts we discussed today are implemented in a real-world.
                </aside>
            </section>

            <!-- Best Practices -->
            <section>
                <h2>Best Practices & Takeaways</h2>
                <div class="content">
                    <ul>
                        <li class="fragment">Start with Least Privilege</li>
                        <li class="fragment">Implement Network Segmentation</li>
                        <li class="fragment">Enable Runtime Security</li>
                        <li class="fragment">Monitor and Audit Everything</li>
                    </ul>
                </div>
                <aside class="notes">
                    As we wrap up, remember these key points: Always start with least privilege - give only the
                    permissions that
                    are absolutely necessary. Implement proper network segmentation using Cilium. Enable runtime
                    security with
                    Tetragon. And most importantly, maintain continuous monitoring and auditing of your security
                    posture.
                </aside>
            </section>

            <!-- Resources -->
            <section>
                <h2>Resources & Next Steps</h2>
                <div class="content">
                    <ul>
                        <li><a href="https://cilium.io">Cilium Documentation</a></li>
                        <li><a href="https://github.com/cilium/tetragon">Tetragon GitHub</a></li>
                        <li><a href="https://kubernetes.io/docs/concepts/security/">Kubernetes Security</a></li>
                    </ul>
                    <p class="contact">Contact: your@email.com</p>
                </div>
                <aside class="notes">
                    Thank you for your attention! Here are some resources to help you continue learning about zero trust
                    security
                    with eBPF and Cilium. Feel free to reach out if you have any questions. The journey to zero trust is
                    continuous,
                    and these tools make it achievable.
                </aside>
            </section>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.js"></script>

    <script>
        Reveal.initialize({
            controls: true,
            progress: true,
            // center: true,
            hash: true,
            transition: 'slide',
            showNotes: false,
            width: 1440,
            height: 1050,
            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealNotes]
        });
    </script>
</body>

</html>
